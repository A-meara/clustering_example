Bootstrap: docker
From: rocker/tidyverse:4.3.3

%labels

    AUTHOR izaskun.mallona@gmail.com

%post

    # Install python3.12
    apt-get update
    apt install -y build-essential zlib1g-dev libncurses5-dev libgdbm-dev libnss3-dev libssl-dev \
        libreadline-dev libffi-dev libsqlite3-dev wget libbz2-dev python-is-python3 git \
        libgsl-dev

    wget https://www.python.org/ftp/python/3.12.6/Python-3.12.6.tgz
    tar -xf Python-3.12.6.tgz
    cd Python-3.12.*/
    ./configure --enable-optimizations
    make -j 4
    make altinstall

    # virtualenv
    cd /opt
    python3.12 -m venv "default"
    . default/bin/activate

    pip install gitpython==3.1.43 isodate "pydantic-core==2.34.1"

    ## no versioning here - fcps deps
    Rscript -e 'BiocManager::install(c("kernlab", "cclust", "dbscan", "kohonen", "MCL", "ADPclust", "cluster", "DatabionicSwarm", "orclus", "subspace", "flexclust", "ABCanalysis", "apcluster", "pracma", "EMCluster", "pdfCluster", "parallelDist", "plotly", "ProjectionBasedClustering", "GeneralizedUmatrix", "mstknnclust", "densityClust", "parallel", "energy", "R.utils", "tclust", "Spectrum", "genie", "protoclust", "fastcluster", "clusterability", "signal", "reshape2", "PPCI", "clustrd", "smacof", "rgl", "prclust", "dendextend", "moments", "prabclus", "VarSelLCM", "sparcl", "mixtools", "HDclassif", "clustvarsel", "knitr", "rmarkdown", "R.utils", "FCPS"))' 

    ## no versioning here -- plotting deps
    Rscript -e 'BiocManager::install(c("rmarkdown", "svglite", "ggplot2", "tidyr", "ComplexHeatmap", "argparse"))' 

    echo '. /opt/default/bin/activate' >> $SINGULARITY_ENVIRONMENT

%environment
    
    . /opt/default/bin/activate
